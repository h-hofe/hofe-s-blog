<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>项目开发记录 | Hofe's blog</title><meta name="description" content="项目开发记录"><meta name="keywords" content="Dubbo"><meta name="author" content="hofe"><meta name="copyright" content="hofe"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="http://ta.qq.com"/><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="crossorigin"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="baidu-site-verification" content="JoP76yOkd4"/><meta name="twitter:card" content="summary"><meta name="twitter:title" content="项目开发记录"><meta name="twitter:description" content="项目开发记录"><meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/hhf443/blog-graph/img/20200427153333.png"><meta property="og:type" content="article"><meta property="og:title" content="项目开发记录"><meta property="og:url" content="http://hofe.work/2020/04/15/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A4/Dubbo%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91%E8%AE%B0%E5%BD%95/"><meta property="og:site_name" content="Hofe's blog"><meta property="og:description" content="项目开发记录"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/hhf443/blog-graph/img/20200427153333.png"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>var autoChangeMode = 'false'
var t = Cookies.get("theme")
if (autoChangeMode == '1'){
  var isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
  var isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
  var isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined){
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport){
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour < 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
  }
  } else if (t == 'light') activateLightMode()
  else activateDarkMode()

} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css"><link rel="canonical" href="http://hofe.work/2020/04/15/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A4/Dubbo%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91%E8%AE%B0%E5%BD%95/"><link rel="prev" title="Java多线程学习笔记" href="http://hofe.work/2020/04/27/Java/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"><link rel="next" title="Spring Cloud入门实战(三)--集成Ribbon" href="http://hofe.work/2020/04/09/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A4/SpringCloud%E5%85%A5%E9%97%A8%E5%AE%9E%E6%88%98(%E4%BA%8C)%E9%9B%86%E6%88%90Ribbon/"><script async="async" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>(adsbygoogle = window.adsbygoogle || []).push({
  google_ad_client: 'ca-pub-4088686103083456',
  enable_page_level_ads: 'true'
});</script><script src="https://tajs.qq.com/stats?sId=66539762" charset="UTF-8"></script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"http://hofe.work","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: false,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: true,
  fancybox: true,
  Snackbar: {"bookmark":{"message_prev":"按","message_next":"键将本页加入书签"},"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#2d3035","position":"bottom-left"},
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  highlightShrink: 'false',
  isFontAwesomeV5: false,
  isPhotoFigcaption: false
  
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isSidebar: true  
  }</script><noscript><style>
#page-header {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><meta name="generator" content="Hexo 4.2.0"></head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">57</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">58</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">40</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-clock-o"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-comments-o"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/album/"><i class="fa-fw fa fa-camera"></i><span> 相册</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-info-circle"></i><span> 关于</span></a></div></div></div></div><i class="fa fa-arrow-right on" id="toggle-sidebar" aria-hidden="true">     </i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#项目介绍"><span class="toc-text">项目介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#一、项目骨架搭建"><span class="toc-text">一、项目骨架搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-新建一个maven项目以及多个maven模块"><span class="toc-text">1.1 新建一个maven项目以及多个maven模块</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-1-在maven模块下新建maven模块"><span class="toc-text">1.1.1 在maven模块下新建maven模块</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-2-在maven模块下新建springboot模块"><span class="toc-text">1.1.2 在maven模块下新建springboot模块</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-初始项目结构"><span class="toc-text">1.2 初始项目结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-basic中的公用组件"><span class="toc-text">1.3 basic中的公用组件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-1-common组件"><span class="toc-text">1.3.1 common组件</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#IBaseDao和IBaseService"><span class="toc-text">IBaseDao和IBaseService</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#serviceImpl"><span class="toc-text">serviceImpl</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-记录下用到的端口号"><span class="toc-text">1.4 记录下用到的端口号</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#二、商品类别接口服务"><span class="toc-text">二、商品类别接口服务</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-basic模块配置"><span class="toc-text">2.1 basic模块配置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-1-entity配置"><span class="toc-text">2.4.1 entity配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-2-dao配置"><span class="toc-text">2.4.2 dao配置</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-api接口模块配置"><span class="toc-text">2.2 api接口模块配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-服务提供者配置"><span class="toc-text">2.3 服务提供者配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-服务消费者配置"><span class="toc-text">2.3 服务消费者配置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#三、RabbitMQ消息队列（未完成）"><span class="toc-text">三、RabbitMQ消息队列（未完成）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-消息队列的应用场景"><span class="toc-text">3.1 消息队列的应用场景</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#四、单点登陆"><span class="toc-text">四、单点登陆</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-登录方案设计"><span class="toc-text">4.1 登录方案设计</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-1-前后端未分离下的登陆系统的设计"><span class="toc-text">4.1.1 前后端未分离下的登陆系统的设计</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-2前后端分离下的登陆系统设计"><span class="toc-text">4.1.2前后端分离下的登陆系统设计</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-3-微服务分布式下的登陆系统设计"><span class="toc-text">4.1.3 微服务分布式下的登陆系统设计</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-服务消费者配置"><span class="toc-text">4.2 服务消费者配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-服务提供者配置"><span class="toc-text">4.3 服务提供者配置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#五、购物车"><span class="toc-text">五、购物车</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-购物车方案设计"><span class="toc-text">5.1 购物车方案设计</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-服务提供者配置"><span class="toc-text">5.2 服务提供者配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-服务消费者配置"><span class="toc-text">5.3 服务消费者配置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#六、购物车优化"><span class="toc-text">六、购物车优化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-回顾下之前购物车方案设计"><span class="toc-text">6.1 回顾下之前购物车方案设计</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-优化的购物车设计方案"><span class="toc-text">6.2 优化的购物车设计方案</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#七、订单模块（未完成）"><span class="toc-text">七、订单模块（未完成）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1-方案设计"><span class="toc-text">7.1 方案设计</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#八出现的问题"><span class="toc-text">八出现的问题</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#问题：在service中因为无法找到dao实现类导致的自动注入失败"><span class="toc-text">问题：在service中因为无法找到dao实现类导致的自动注入失败</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#问题：找不到dao中的方法"><span class="toc-text">问题：找不到dao中的方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#问题：字段名为name、desc时查询出错"><span class="toc-text">问题：字段名为name、desc时查询出错</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#问题：平级转树形结构问题"><span class="toc-text">问题：平级转树形结构问题</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#问题：dubbo超时"><span class="toc-text">问题：dubbo超时</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#问题：SSO单点登录模块跨域问题"><span class="toc-text">问题：SSO单点登录模块跨域问题</span></a></li></ol></li></ol></li></ol></div></div></div><div id="body-wrap"><div class="post-bg" id="nav" style="background-image: url(https://cdn.jsdelivr.net/gh/hhf443/blog-graph/img/20200427153333.png)"><div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">Hofe's blog</a></span><span class="pull_right menus"><div id="search_button"><a class="site-page social-icon search"><i class="fa fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-clock-o"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-comments-o"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/album/"><i class="fa-fw fa fa-camera"></i><span> 相册</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-info-circle"></i><span> 关于</span></a></div></div><span class="toggle-menu close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span></span></div><div id="post-info"><div id="post-title"><div class="posttitle">项目开发记录</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="发表于 2020-04-15 00:00:00"><i class="fa fa-calendar" aria-hidden="true"></i> 发表于 2020-04-15</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="更新于 2020-04-27 15:34:22"><i class="fa fa-history" aria-hidden="true"></i> 更新于 2020-04-27</span></time><span class="post-meta__categories"><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/%E5%BE%AE%E6%9C%8D%E5%8A%A1/">微服务</a><i class="fa fa-angle-right post-meta__separator" aria-hidden="true"></i><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/%E5%BE%AE%E6%9C%8D%E5%8A%A1/Dubbo/">Dubbo</a><i class="fa fa-angle-right post-meta__separator" aria-hidden="true"></i><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/%E5%BE%AE%E6%9C%8D%E5%8A%A1/Dubbo/%E5%85%A5%E9%97%A8%E5%AE%9E%E6%88%98/">入门实战</a></span></div><div class="meta-secondline"> <span class="post-meta-wordcount"><i class="post-meta__icon fa fa-file-word-o" aria-hidden="true"></i><span>字数总计:</span><span class="word-count">8.5k</span><span class="post-meta__separator">|</span><i class="post-meta__icon fa fa-clock-o" aria-hidden="true"></i><span>阅读时长: 35 分钟</span></span></div><div class="meta-thirdline"><span class="post-meta-pv-cv"><span class="post-meta__separator">|</span><i class="fa fa-eye post-meta__icon" aria-hidden="true"> </i><span>阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"><span class="post-meta__separator">|</span><i class="post-meta__icon fa fa-comment-o" aria-hidden="true"></i><span>评论数:</span><a href="/2020/04/15/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A4/Dubbo%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91%E8%AE%B0%E5%BD%95/#post-comment" itemprop="discussionUrl"><span class="valine-comment-count comment-count" data-xid="/2020/04/15/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A4/Dubbo%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91%E8%AE%B0%E5%BD%95/" itemprop="commentCount"></span></a></span></div></div></div></div><main class="layout_post" id="content-inner"><article id="post"><div id="article-container"><blockquote>
<p>应该说这个项目完成的不是特别理想，有一些模块还没完成，但单点登录、redis缓存、购物车的设计部分值得参考，以及项目如何分包，结构的描述都挺详细的，对于微服务分布式入门来说，还是挺有价值的。<br>可以访问我个人网站<a href="http://hofe.work">hofe 的个人网站</a>，阅读体验更佳，需要源代码，有疑问的也可在评论区留言</p>
</blockquote>
<h2 id="项目介绍"><a href="#项目介绍" class="headerlink" title="项目介绍"></a>项目介绍</h2><p>用到的技术</p>
<p>微服务架构：Dubbo+zookeeper </p>
<p>中间件：SpringBoot+SpringMVC+Sprint+MyBatis</p>
<p>数据库：MySQL</p>
<p>分布式文件系统：FastDFS</p>
<p>搜索引擎：Solr</p>
<p>分布式缓存：Redis</p>
<p>消息中间件：RabbitMQ</p>
<h2 id="一、项目骨架搭建"><a href="#一、项目骨架搭建" class="headerlink" title="一、项目骨架搭建"></a>一、项目骨架搭建</h2><h3 id="1-1-新建一个maven项目以及多个maven模块"><a href="#1-1-新建一个maven项目以及多个maven模块" class="headerlink" title="1.1 新建一个maven项目以及多个maven模块"></a>1.1 新建一个maven项目以及多个maven模块</h3><p>只作为一个目录使用，不需要配置pom，可以删除src文件。</p>
<p>如在dubbo-shop项目下新建shop-service模块，将Parent设为none。同样步骤创建shop-basic、shop-api、shop-web模块。<br><img src="/" class="lazyload" data-src="https://img-blog.csdnimg.cn/20200415163806195.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxMDExNzIz,size_16,color_FFFFFF,t_70"  alt="在这里插入图片描述"><br><img src="/" class="lazyload" data-src="https://img-blog.csdnimg.cn/20200415163822406.png"  alt="在这里插入图片描述"></p>
<h4 id="1-1-1-在maven模块下新建maven模块"><a href="#1-1-1-在maven模块下新建maven模块" class="headerlink" title="1.1.1 在maven模块下新建maven模块"></a>1.1.1 在maven模块下新建maven模块</h4><p>在shop-basic模块中新建entity，需要注意的是entity模块目录在shop-basic至下。同理创建common、mapper模块<br><img src="/" class="lazyload" data-src="https://img-blog.csdnimg.cn/20200415162428245.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxMDExNzIz,size_16,color_FFFFFF,t_70"  alt="在这里插入图片描述"></p>
<h4 id="1-1-2-在maven模块下新建springboot模块"><a href="#1-1-2-在maven模块下新建springboot模块" class="headerlink" title="1.1.2 在maven模块下新建springboot模块"></a>1.1.2 在maven模块下新建springboot模块</h4><p>在shop-service下新建springboot模块。<br><img src="/" class="lazyload" data-src="https://img-blog.csdnimg.cn/20200415164631301.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxMDExNzIz,size_16,color_FFFFFF,t_70"  alt="在这里插入图片描述"><br><img src="/" class="lazyload" data-src="https://img-blog.csdnimg.cn/20200415164741278.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxMDExNzIz,size_16,color_FFFFFF,t_70"  alt="在这里插入图片描述"><br><img src="/" class="lazyload" data-src="https://img-blog.csdnimg.cn/20200415165016740.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxMDExNzIz,size_16,color_FFFFFF,t_70"  alt="在这里插入图片描述"><br><img src="/" class="lazyload" data-src="https://img-blog.csdnimg.cn/20200415165035144.png"  alt="在这里插入图片描述"></p>
<h3 id="1-2-初始项目结构"><a href="#1-2-初始项目结构" class="headerlink" title="1.2 初始项目结构"></a>1.2 初始项目结构</h3><p>dubbo-shop</p>
<ul>
<li>shop-api</li>
<li>shop-service<ul>
<li>profuct-service（SpringBoot）</li>
</ul>
</li>
<li>shop-web<ul>
<li>backend（SpringBoot）</li>
</ul>
</li>
<li>shop-basic<ul>
<li>entity</li>
<li>common    存放公共组件如dao的泛型接口</li>
<li>dao<br><img src="/" class="lazyload" data-src="https://img-blog.csdnimg.cn/20200415170223387.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxMDExNzIz,size_16,color_FFFFFF,t_70"  alt="在这里插入图片描述"></li>
</ul>
</li>
</ul>
<h3 id="1-3-basic中的公用组件"><a href="#1-3-basic中的公用组件" class="headerlink" title="1.3 basic中的公用组件"></a>1.3 basic中的公用组件</h3><h4 id="1-3-1-common组件"><a href="#1-3-1-common组件" class="headerlink" title="1.3.1 common组件"></a>1.3.1 common组件</h4><h5 id="IBaseDao和IBaseService"><a href="#IBaseDao和IBaseService" class="headerlink" title="IBaseDao和IBaseService"></a>IBaseDao和IBaseService</h5><p>由于增删查改等操作比较频繁且可重用性大，故在common模块中新建com.hofe.common.base目录，新建dao与service接口；在com.hofe.common.impl中实现service接口的抽象类。<br>dao与service接口代码相同</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IBaseDao</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function">T <span class="title">queryById</span><span class="params">(Long id)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">List&lt;T&gt; <span class="title">queryAllByLimit</span><span class="params">(<span class="keyword">int</span> offset, <span class="keyword">int</span> limit)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">List&lt;T&gt; <span class="title">queryAll</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">insert</span><span class="params">(T record)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">update</span><span class="params">(T record)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">deleteById</span><span class="params">(Long id)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="serviceImpl"><a href="#serviceImpl" class="headerlink" title="serviceImpl"></a>serviceImpl</h5><p>由于使用泛型，无法返回准确类型，故将其abstract抽象，由继承的子类返回类型。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> com.hofe.common.base.IBaseDao;</span><br><span class="line"><span class="keyword">import</span> com.hofe.common.base.IBaseService;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseServiceImpl</span>&lt;<span class="title">T</span>&gt; <span class="keyword">implements</span> <span class="title">IBaseService</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> IBaseDao&lt;T&gt; <span class="title">getBaseDao</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">queryById</span><span class="params">(Long id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getBaseDao().queryById(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;T&gt; <span class="title">queryAllByLimit</span><span class="params">(<span class="keyword">int</span> offset, <span class="keyword">int</span> limit)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getBaseDao().queryAllByLimit(offset, limit);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;T&gt; <span class="title">queryAll</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getBaseDao().queryAll();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">insert</span><span class="params">(T record)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getBaseDao().insert(record);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">update</span><span class="params">(T record)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getBaseDao().update(record);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">deleteById</span><span class="params">(Long id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getBaseDao().deleteById(id);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<h3 id="1-4-记录下用到的端口号"><a href="#1-4-记录下用到的端口号" class="headerlink" title="1.4 记录下用到的端口号"></a>1.4 记录下用到的端口号</h3><p>dubbo管理中心端口：2180<br>zookeeper端口：2181<br>fdfs文件服务器：<br>tracker server port: 22122<br>storage_server: 23000<br>RabbitMQ: 15672(admin:admin)</p>
<h2 id="二、商品类别接口服务"><a href="#二、商品类别接口服务" class="headerlink" title="二、商品类别接口服务"></a>二、商品类别接口服务</h2><h3 id="2-1-basic模块配置"><a href="#2-1-basic模块配置" class="headerlink" title="2.1 basic模块配置"></a>2.1 basic模块配置</h3><p>这一模块我后来回头来看，其实不是特别需要，虽然重用了很多代码，但对小规模的项目来说，可以不需要，不利于项目的维护。</p>
<h4 id="2-4-1-entity配置"><a href="#2-4-1-entity配置" class="headerlink" title="2.4.1 entity配置"></a>2.4.1 entity配置</h4><p>可以用easycode插件根据数据库生成实体类。注意类需要实现Serializable接口</p>
<h4 id="2-4-2-dao配置"><a href="#2-4-2-dao配置" class="headerlink" title="2.4.2 dao配置"></a>2.4.2 dao配置</h4><p><strong>dao类</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">TProductTypeDao</span> <span class="keyword">extends</span> <span class="title">IBaseDao</span>&lt;<span class="title">TProductType</span>&gt;</span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>由于IBaseService有具体实现故这里可以省略。</p>
<p><strong>dao.xml</strong><br>这里需要注意的是xml配置的路径是否正确、是否在bean扫描路径下、表字段名name、desc会冲突等问题<br><img src="/" class="lazyload" data-src="https://img-blog.csdnimg.cn/20200416215337164.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxMDExNzIz,size_16,color_FFFFFF,t_70"  alt="在这里插入图片描述"><br><strong>pom配置</strong><br>由于用到entity、common中的基本类，故需引入模块；</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&lt;dependencies&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!--集成mybatis--&gt;</span><br><span class="line">        &lt;!--集成事务--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.3.2&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;mysql&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;5.1.47&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.hofe&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;entity&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.hofe&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;common&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">    &lt;/dependencies&gt;</span><br></pre></td></tr></table></figure>


<h3 id="2-2-api接口模块配置"><a href="#2-2-api接口模块配置" class="headerlink" title="2.2 api接口模块配置"></a>2.2 api接口模块配置</h3><p> <strong>api服务接口</strong><br> 集成common中的基本业务接口，后续该接口由Service实现。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> com.hofe.common.base.IBaseService;</span><br><span class="line"><span class="keyword">import</span> com.hofe.entity.TProductType;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 商品类别接口, 集成common中的Service，通过泛型确定类，再由service模块实现api模块的这个接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IProductTypeService</span> <span class="keyword">extends</span> <span class="title">IBaseService</span>&lt;<span class="title">TProductType</span>&gt;</span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>pom配置</strong><br>由于需要TProductType、IBaseService故引入entity、common依赖。</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&lt;dependencies&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;com.hofe&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;common&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;com.hofe&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;entity&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">&lt;/dependencies&gt;</span><br></pre></td></tr></table></figure>

<h3 id="2-3-服务提供者配置"><a href="#2-3-服务提供者配置" class="headerlink" title="2.3 服务提供者配置"></a>2.3 服务提供者配置</h3><p><strong>启动类</strong><br>加入@EnableDubbo注解以及需要加入@MapperScan(“com.hofe.dao”)注解</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableDubbo</span></span><br><span class="line"><span class="meta">@MapperScan</span>(<span class="string">"com.hofe.dao"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProductServiceApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		SpringApplication.run(ProductServiceApplication<span class="class">.<span class="keyword">class</span>, <span class="title">args</span>)</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>接口Service实现类</strong><br>依赖Dao层，调用相应dao执行具体业务。这里的getBaseDao()方法用于dao被调用时返回具体dao类型（抽象类、接口用的泛型）</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Service</span>    <span class="comment">// dubbo的service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProductTypeService</span> <span class="keyword">extends</span> <span class="title">BaseServiceImpl</span>&lt;<span class="title">TProductType</span>&gt; <span class="keyword">implements</span> <span class="title">IProductTypeService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> TProductTypeDao productTypeDao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> IBaseDao&lt;TProductType&gt; <span class="title">getBaseDao</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> productTypeDao;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>application.yml</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">server:</span><br><span class="line">  port: <span class="number">8080</span></span><br><span class="line">dubbo:</span><br><span class="line">  application:</span><br><span class="line">    name: product-service</span><br><span class="line">  registry:</span><br><span class="line">    protocol: zookeeper</span><br><span class="line">    address: ip:<span class="number">2181</span></span><br><span class="line">  protocol: <span class="number">28801</span></span><br><span class="line"></span><br><span class="line">spring:</span><br><span class="line">  datasource: # 数据库配置</span><br><span class="line">    driver-class-name: com.mysql.jdbc.Driver</span><br><span class="line">    url: jdbc:mysql:<span class="comment">//ip:3306/dubbo_shop?useSSL=false&amp;useUnicode=true&amp;characterEncoding=utf-8&amp;allowMultiQueries=true&amp;autoReconnect=true&amp;failOverReadOnly=false&amp;maxReconnects=10</span></span><br><span class="line">    username: root</span><br><span class="line">    password: ***</span><br><span class="line">    hikari:</span><br><span class="line">      maximum-pool-size: 10 # 最大连接池数</span><br><span class="line">      max-lifetime: <span class="number">1770000</span></span><br><span class="line"></span><br><span class="line">mybatis:</span><br><span class="line">  # 指定别名设置的包为所有entity</span><br><span class="line">  type-aliases-<span class="keyword">package</span>: cn.hofe.entity</span><br><span class="line">  configuration:</span><br><span class="line">    map-underscore-to-camel-case: true # 驼峰命名规范</span><br><span class="line">  mapper-locations: # mapper映射文件位置</span><br><span class="line">    - classpath:mapper<span class="comment">/*.xml</span></span><br></pre></td></tr></table></figure>

<p><strong>pom配置</strong><br>加入api、dao依赖包也会加入它们各自的依赖包；所以即使用到mybatis也可以不用引入依赖。</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&lt;dependencies&gt;</span><br><span class="line">		&lt;dependency&gt;</span><br><span class="line">			&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class="line">		&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">		&lt;dependency&gt;</span><br><span class="line">			&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;</span><br><span class="line">			&lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">			&lt;exclusions&gt;</span><br><span class="line">				&lt;exclusion&gt;</span><br><span class="line">					&lt;groupId&gt;org.junit.vintage&lt;/groupId&gt;</span><br><span class="line">					&lt;artifactId&gt;junit-vintage-engine&lt;/artifactId&gt;</span><br><span class="line">				&lt;/exclusion&gt;</span><br><span class="line">			&lt;/exclusions&gt;</span><br><span class="line">		&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">		&lt;!-- Dubbo依赖--&gt;</span><br><span class="line">		&lt;dependency&gt;</span><br><span class="line">			&lt;groupId&gt;com.alibaba.boot&lt;/groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;dubbo-spring-boot-starter&lt;/artifactId&gt;</span><br><span class="line">			&lt;version&gt;0.2.0&lt;/version&gt;</span><br><span class="line">		&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">		&lt;dependency&gt;</span><br><span class="line">			&lt;groupId&gt;com.hofe&lt;/groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;product-api&lt;/artifactId&gt;</span><br><span class="line">			&lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;</span><br><span class="line">		&lt;/dependency&gt;</span><br><span class="line">		&lt;dependency&gt;</span><br><span class="line">			&lt;groupId&gt;com.hofe&lt;/groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;dao&lt;/artifactId&gt;</span><br><span class="line">			&lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;</span><br><span class="line">		&lt;/dependency&gt;</span><br><span class="line">		</span><br><span class="line">	&lt;/dependencies&gt;</span><br><span class="line"></span><br><span class="line">	&lt;build&gt;</span><br><span class="line">		&lt;plugins&gt;</span><br><span class="line">			&lt;plugin&gt;</span><br><span class="line">				&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">				&lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;</span><br><span class="line">			&lt;/plugin&gt;</span><br><span class="line">		&lt;/plugins&gt;</span><br><span class="line">	&lt;/build&gt;</span><br></pre></td></tr></table></figure>

<h3 id="2-3-服务消费者配置"><a href="#2-3-服务消费者配置" class="headerlink" title="2.3 服务消费者配置"></a>2.3 服务消费者配置</h3><p><strong>启动类</strong><br>在启动类中添加@EnableDubbo注解</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.config.spring.context.annotation.EnableDubbo;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line"><span class="meta">@EnableDubbo</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BackendApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		SpringApplication.run(BackendApplication<span class="class">.<span class="keyword">class</span>, <span class="title">args</span>)</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>controller</strong><br>在Controller中依赖处添加@Reference应用。将由服务提供者的Service执行具体业务。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.config.annotation.Reference;</span><br><span class="line"><span class="keyword">import</span> com.hofe.api.product.IProductTypeService;</span><br><span class="line"><span class="keyword">import</span> com.hofe.entity.TProductType;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"productType"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProductTypeController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Reference</span></span><br><span class="line">    <span class="keyword">private</span> IProductTypeService productTypeService;     <span class="comment">// 引用 Servic模块的服务</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"list"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;TProductType&gt; <span class="title">productTypeList</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> productTypeService.queryAll();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>application.yml</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">server:</span><br><span class="line">  port: <span class="number">9090</span></span><br><span class="line">dubbo:</span><br><span class="line">  application:</span><br><span class="line">    name: backend</span><br><span class="line">  registry:</span><br><span class="line">    protocol: zookeeper</span><br><span class="line">    address: ip:<span class="number">2181</span></span><br></pre></td></tr></table></figure>

<p><strong>pom配置</strong><br>由于需要用到服务消费者故需引入api模块</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&lt;dependencies&gt;</span><br><span class="line">		&lt;dependency&gt;</span><br><span class="line">			&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class="line">		&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">		&lt;dependency&gt;</span><br><span class="line">			&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;</span><br><span class="line">			&lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">			&lt;exclusions&gt;</span><br><span class="line">				&lt;exclusion&gt;</span><br><span class="line">					&lt;groupId&gt;org.junit.vintage&lt;/groupId&gt;</span><br><span class="line">					&lt;artifactId&gt;junit-vintage-engine&lt;/artifactId&gt;</span><br><span class="line">				&lt;/exclusion&gt;</span><br><span class="line">			&lt;/exclusions&gt;</span><br><span class="line">		&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">		&lt;!-- Dubbo依赖--&gt;</span><br><span class="line">		&lt;dependency&gt;</span><br><span class="line">			&lt;groupId&gt;com.alibaba.boot&lt;/groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;dubbo-spring-boot-starter&lt;/artifactId&gt;</span><br><span class="line">			&lt;version&gt;0.2.0&lt;/version&gt;</span><br><span class="line">		&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">		&lt;dependency&gt;</span><br><span class="line">			&lt;groupId&gt;com.hofe&lt;/groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;product-api&lt;/artifactId&gt;</span><br><span class="line">			&lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;</span><br><span class="line">		&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">	&lt;/dependencies&gt;</span><br></pre></td></tr></table></figure>


<h2 id="三、RabbitMQ消息队列（未完成）"><a href="#三、RabbitMQ消息队列（未完成）" class="headerlink" title="三、RabbitMQ消息队列（未完成）"></a>三、RabbitMQ消息队列（未完成）</h2><h3 id="3-1-消息队列的应用场景"><a href="#3-1-消息队列的应用场景" class="headerlink" title="3.1 消息队列的应用场景"></a>3.1 消息队列的应用场景</h3><p><strong>异步、削峰、解耦</strong>。详情<a href="https://blog.csdn.net/qq_35190492/article/details/103153444?depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-2&utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-2" target="_blank" rel="noopener">点击</a><br><strong>(1) 通过异步处理提高系统性能（削峰、减少响应所需时间）</strong><br>比如秒杀背景下的商品下单，在不使用消息队列服务器的时候，用户的请求数据直接写入数据库，在高并发的情况下数据库压力剧增，使得响应速度变慢。但是在使用消息队列之后，用户的请求数据发送给消息队列之后立即返回，再由消息队列的消费者进程从消息队列中获取数据，异步的对数据库进行操作。由于消息队列服务器处理速度快于数据库（消息队列也比数据库有更好的伸缩性），因此响应速度得到大幅改善。</p>
<p>消息队列具有很好的削峰作用的功能——即通过异步处理，将短时间高并发产生的事务消息存储在消息队列中，从而削平高峰期的并发事务。 </p>
<p>用户请求数据写入消息队列之后就立即返回给用户了，但是请求数据在后续的业务校验、写数据库等操作中可能失败。因此使用消息队列进行异步处理之后，需要适当修改业务流程进行配合，比如用户在提交订单之后，订单数据写入消息队列，不能立即返回用户订单提交成功，需要在消息队列的订单消费者进程真正处理完该订单之后，甚至出库后，再通过电子邮件或短信通知用户订单成功，以免交易纠纷。这就类似我们平时手机订火车票和电影票。</p>
<p><strong>(2) 降低系统耦合性</strong></p>
<p>我们知道如果模块之间不存在直接调用，那么新增模块或者修改模块就对其他模块影响较小，这样系统的可扩展性无疑更好一些。</p>
<p>通过将系统同步交互改为异步交互提高系统的处理的吞吐量<br>发送者：<br>1、声明交换机<br>2、发送消息到交换机</p>
<p>接受者者：<br>1、声明队列<br>2、建立队列与交换机的绑定关系<br>3、创建一个类的方法来监听队列，接收消息</p>
<h2 id="四、单点登陆"><a href="#四、单点登陆" class="headerlink" title="四、单点登陆"></a>四、单点登陆</h2><h3 id="4-1-登录方案设计"><a href="#4-1-登录方案设计" class="headerlink" title="4.1 登录方案设计"></a>4.1 登录方案设计</h3><h4 id="4-1-1-前后端未分离下的登陆系统的设计"><a href="#4-1-1-前后端未分离下的登陆系统的设计" class="headerlink" title="4.1.1 前后端未分离下的登陆系统的设计"></a>4.1.1 前后端未分离下的登陆系统的设计</h4><blockquote>
<p>Session<br>服务端提供了一种叫 Session 的机制，对于每个用户的请求，会生成一个唯一的标识。当程序需要为某个客户端的请求创建一个 session 的时候，服务器首先检查这个客户端的请求是否包含了一个 session 标识（session id）。如果已包含一个 session id 则说明以前已经为客户端创建过 session，服务器就按照 session id 把这个 session 检索出来使用。<br>如果客户端请求不包含 session id，则为此客户端创建一个session 并且生成一个与此 session 相关联的 session id，session id 的值是一个既不会重复，又不容易被找到规律的字符串。<br>Cookie<br>浏览器提供了一种叫 cookie 的机制，保存当前会话的唯一标识。每次 HTTP 请求，客户端都会发送相应的 cookie 信息到服务端。客户端第一次请求，由于 cookie 中并没有携带 session id，服务端会创建一个session id，并写入到客户端的 cookie 中。以后每次请求，客户端都会携带这个 id 发给服务器端。这样一来，便解决了无状态的问题。</p>
</blockquote>
<p>通过设置浏览器的cookie（sessionid），映射服务器的用户session来判断用户登录状况：每次点击登录按钮时后台的response将sessionid的cookie添加到浏览器，后面所有访问请求都带着该cookie，shiro的相关方法就会获取cookie匹配session确定用户登录信息。</p>
<h4 id="4-1-2前后端分离下的登陆系统设计"><a href="#4-1-2前后端分离下的登陆系统设计" class="headerlink" title="4.1.2前后端分离下的登陆系统设计"></a>4.1.2前后端分离下的登陆系统设计</h4><blockquote>
<p>前后端分离的核心概念是后端仅返回前端所需的数据，不再渲染HTML页面，前端HTML页面通过AJAX调用后端的RESTFUL API接口并使用JSON数据进行交互</p>
</blockquote>
<p>目前大多数都采用请求头携带 Token 的形式。</p>
<p>1、首次登录时，后端服务器判断用户账号密码正确之后，根据用户id、用户名、定义好的秘钥、过期时间 生成 token ，返回给前端<br>2、前端拿到后端返回的 token ,存储在 localStroage 里<br>3、前端每次路由跳转， 判断 localStroage 有无 token ，没有则跳转到登录页，有则请求获取用户信息，改变登录状态<br>4、每次请求接口，在 请求头里携带 token<br>5、后端接口 判断 请求头有无 token，没有或者 token 过期，返回401<br>6、前端得到 401 状态码，重定向 到登录页面</p>
<h4 id="4-1-3-微服务分布式下的登陆系统设计"><a href="#4-1-3-微服务分布式下的登陆系统设计" class="headerlink" title="4.1.3 微服务分布式下的登陆系统设计"></a>4.1.3 微服务分布式下的登陆系统设计</h4><p>单点登录就是在A系统登录以后，跳转到B系统，此时可以直接访问B系统的资源，即只需要登录一次，就可以访问其他相互信任的应用系统，免除多次登录的烦恼。实现单点登录说到底就是要解决如何产生和存储那个信任，再就是其他系统如何验证这个信任的有效性，因此要点也就以下两个：存储信任、验证信任。</p>
<h3 id="4-2-服务消费者配置"><a href="#4-2-服务消费者配置" class="headerlink" title="4.2 服务消费者配置"></a>4.2 服务消费者配置</h3><p><strong>SSOController.java</strong><br><strong>用户登录</strong><br>通过前端传递的user信息，与数据库交互判断是否合法，若合法生成uuid，创建名为”user_token”，内容为uuid的cookie，设置cookie的域名为父域名，这样所有子域名系统都可以访问该cookie，解决cookie的跨域问题等等，并将其通过HttpServletResponse添加cookie到浏览器中。同时，通过redisTemplate设置key为user:token:uuid，值为该用户信息的redis数据，并设置过期时间，这样redis服务器就会保存本次登陆的信息。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span>(<span class="string">"checkLogin"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">checkLogin</span><span class="params">(TUser user, HttpServletResponse response)</span></span>&#123;</span><br><span class="line">        TUser currentUser = userService.checkLogin(user);</span><br><span class="line">        <span class="keyword">if</span>(currentUser == <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"fail"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        String uuid = UUID.randomUUID().toString();</span><br><span class="line">        <span class="comment">// 在浏览器中可以看到user_token对应的uuid</span></span><br><span class="line">        Cookie cookie = <span class="keyword">new</span> Cookie(<span class="string">"user_token"</span>, uuid);</span><br><span class="line">        cookie.setPath(<span class="string">"/"</span>);</span><br><span class="line">        cookie.setHttpOnly(<span class="keyword">true</span>);</span><br><span class="line">        <span class="comment">// redis中的key位user:token:uuid</span></span><br><span class="line">        StringBuilder redisKey = <span class="keyword">new</span> StringBuilder(<span class="string">"user:token:"</span>).append(uuid);</span><br><span class="line"></span><br><span class="line">        redisTemplate.setValueSerializer(<span class="keyword">new</span> StringRedisSerializer());</span><br><span class="line">        <span class="comment">// 客户端得到uuid，就可以用user:token:uuid从redis中取得currentUser信息</span></span><br><span class="line">        redisTemplate.opsForValue().set(redisKey, currentUser);</span><br><span class="line">        <span class="comment">//设置有效期</span></span><br><span class="line">        redisTemplate.expire(redisKey.toString(), <span class="number">30</span>, TimeUnit.MINUTES);</span><br><span class="line">        response.addCookie(cookie);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"login success"</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p><strong>判断是否登录</strong><br>通过HttpServletRequest获取请求报文带来的cookies信息，判断是否包含user_token，若包含则获取该cookie对应的uuid，通过键user:token:uuid获取redis保存的用户信息，并刷新其有效期。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span>(<span class="string">"checkIsLogin"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">checkIsLogin</span><span class="params">(HttpServletRequest request)</span></span>&#123;</span><br><span class="line">        Cookie[] cookies = request.getCookies();</span><br><span class="line">        <span class="keyword">if</span>(cookies == <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"用户未登陆"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (Cookie cookie : cookies)&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="string">"user_token"</span>.equals(cookie.getName()))&#123;</span><br><span class="line">                String uuid = cookie.getValue();</span><br><span class="line">                StringBuilder redisKey = <span class="keyword">new</span> StringBuilder(<span class="string">"user:token:"</span>).append(uuid);</span><br><span class="line"></span><br><span class="line">                TUser currentUser = (TUser) redisTemplate.opsForValue().get(redisKey.toString());</span><br><span class="line">                <span class="keyword">if</span>(currentUser != <span class="keyword">null</span>)&#123;</span><br><span class="line">                    <span class="comment">//刷新有效期</span></span><br><span class="line">                    redisTemplate.expire(redisKey.toString(), <span class="number">30</span>, TimeUnit.MINUTES);</span><br><span class="line">                    <span class="keyword">return</span> currentUser.getUsername();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"用户为登陆"</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><strong>注销</strong><br>通过uuid新建cookie，并设置其失效，重新添加回浏览器的客户端，同时也要删除其对应的redis数据。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span>(<span class="string">"logout"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">logout</span><span class="params">(@CookieValue(name = <span class="string">"user_token"</span>, required = <span class="keyword">false</span>)</span> String uuid,</span></span><br><span class="line"><span class="function">                         HttpServletResponse response)</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(uuid == <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"注销失败"</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Cookie cookie = <span class="keyword">new</span> Cookie(<span class="string">"user_token"</span>, uuid);</span><br><span class="line">        cookie.setPath(<span class="string">"/"</span>);</span><br><span class="line">        cookie.setHttpOnly(<span class="keyword">true</span>);</span><br><span class="line">        <span class="comment">// 使cookie失效</span></span><br><span class="line">        cookie.setMaxAge(<span class="number">0</span>);</span><br><span class="line">        response.addCookie(cookie);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 删除redis</span></span><br><span class="line">        StringBuilder redisKey = <span class="keyword">new</span> StringBuilder(<span class="string">"user:token:"</span>).append(uuid);</span><br><span class="line">        redisTemplate.setKeySerializer(<span class="keyword">new</span> StringRedisSerializer());</span><br><span class="line">        redisTemplate.delete(redisKey.toString());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"注销成功"</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p><strong>pom配置</strong><br>与普通的消费者配置差不多，只是多了redis引入。</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">			&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;</span><br><span class="line">		&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<p><strong>application.yml配置</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">server:</span><br><span class="line">  port: <span class="number">9099</span></span><br><span class="line">dubbo:</span><br><span class="line">  application:</span><br><span class="line">    name: sso</span><br><span class="line">  registry:</span><br><span class="line">    protocol: zookeeper</span><br><span class="line">    address: ip:<span class="number">2181</span></span><br><span class="line">  consumer:</span><br><span class="line">    timeout: <span class="number">30000</span></span><br><span class="line">spring:</span><br><span class="line">  redis:</span><br><span class="line">    host: ip</span><br><span class="line">    port: <span class="number">6379</span></span><br><span class="line">    jedis:</span><br><span class="line">      pool:</span><br><span class="line">        max-active: <span class="number">20</span></span><br></pre></td></tr></table></figure>

<h3 id="4-3-服务提供者配置"><a href="#4-3-服务提供者配置" class="headerlink" title="4.3 服务提供者配置"></a>4.3 服务提供者配置</h3><p><strong>UserService.java</strong><br>和普通的提供者一样，数据库的增删查改操作。</p>
<p><strong>application.yml配置</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">dubbo:</span><br><span class="line">  application:</span><br><span class="line">    name: user-service</span><br><span class="line">  registry:</span><br><span class="line">    protocol: zookeeper</span><br><span class="line">    address: ip:<span class="number">2181</span></span><br><span class="line">  protocol: <span class="number">28808</span></span><br><span class="line">  provider:</span><br><span class="line">    timeout: <span class="number">30000</span></span><br><span class="line"></span><br><span class="line">spring:</span><br><span class="line">  datasource:</span><br><span class="line">    driver-class-name: com.mysql.jdbc.Driver</span><br><span class="line">    url: jdbc:mysql:<span class="comment">//ip:3306/dubbo_shop?useSSL=false&amp;useUnicode=true&amp;characterEncoding=utf-8&amp;allowMultiQueries=true&amp;autoReconnect=true&amp;failOverReadOnly=false&amp;maxReconnects=10</span></span><br><span class="line">    username: root</span><br><span class="line">    password: <span class="number">123456</span></span><br><span class="line">    hikari:</span><br><span class="line">      maximum-pool-size: <span class="number">10</span> </span><br><span class="line">      max-lifetime: <span class="number">1770000</span></span><br><span class="line"></span><br><span class="line">mybatis:</span><br><span class="line">  # entity路径</span><br><span class="line">  type-aliases-<span class="keyword">package</span>: com.hofe</span><br><span class="line">  configuration:</span><br><span class="line">    map-underscore-to-camel-<span class="keyword">case</span>: <span class="keyword">true</span></span><br><span class="line">  mapper-locations: # mapper资源路径</span><br><span class="line">    - classpath:mapper<span class="comment">/*.xml</span></span><br></pre></td></tr></table></figure>




<h2 id="五、购物车"><a href="#五、购物车" class="headerlink" title="五、购物车"></a>五、购物车</h2><h3 id="5-1-购物车方案设计"><a href="#5-1-购物车方案设计" class="headerlink" title="5.1 购物车方案设计"></a>5.1 购物车方案设计</h3><p>需要实现以下功能：<br>1、未登录时可操作购物车且退出浏览器之后依然存在信息<br>2、未登录时购物车支持增删查改、排序商品<br>3、登陆时自动合并未登录与登陆时的商品，且未登录时购物车商品将清空。<br>4、商品信息变更，购物车也需变更<br>5、已登录购物车在任何地方信息都一样</p>
<p>未登录购物车实现方案一：cookie<br>用list保存购物车中的商品信息和对应数量的对象，再将其转化为json，最后用cookie保存购物车和list的键值对。但如果商品信息变更，cookie保存的是商品的信息，则无法修改，故最好改成商品id与数量的对应关系。<br>不足：<br>1、展示购物车需要查看数据库，可以把20%的商品放到缓存中（缓存预热）<br>2、cookie的物理上限4k<br>3、更新删除操作需要遍历</p>
<p>未登录购物车实现方案二：cookie+redis<br>购物车保存信息：每一项（id+数量+操作时间），购物车包含多项。后端使用redis存储购物车信息，并做热门商品的缓存。前端cookie保存信息简化，只作保存凭证（user_cart—-uuid）。这样后端也省略了json转换。cookie不是会话级cookie，否则退出浏览器即消失。<br>不足：更新需要遍历</p>
<p>已登录购物车方案一：数据库<br>每个用户一辆购物车，字段需要有id\user_id\product_id\count\update，每行是一条购物车记录，user_id和product_id是唯一约束。</p>
<p>已登录购物车方案二：redis<br>每个用户一辆购物车，user:cart:uuid改为user:cart:userid<br>控制层通过判断用户是否登录决定用user:cart:uuid还是user:cart:userid，从客户端到controller之间可以加个拦截器，任何时候都放行，只记录状态，放入request中。<br>好处：性能<br>坏处：虽然是持久化机制，但可能有数据间歇性丢失</p>
<p>合并购物车方案：<br>通过user:cart:uuid/userId的方式判断有无登陆状态下的购物车，通过遍历两种购物车，用map存商品id对应的表项，最后合并成一个list，同时还需清除原先的cookie，因为未登录状态下的购物车信息是由cookie保存的。</p>
<h3 id="5-2-服务提供者配置"><a href="#5-2-服务提供者配置" class="headerlink" title="5.2 服务提供者配置"></a>5.2 服务提供者配置</h3><p>未登录时购物车的Service</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hofe.cartservice.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.config.annotation.Service;</span><br><span class="line"><span class="keyword">import</span> com.hofe.api.cart.ICartService;</span><br><span class="line"><span class="keyword">import</span> com.hofe.api.cart.pojo.CartItem;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CartServiceImpl</span> <span class="keyword">implements</span> <span class="title">ICartService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> TProductDao productDao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">add</span><span class="params">(String key, Long productId, Integer count)</span> </span>&#123;</span><br><span class="line">        List&lt;CartItem&gt; cart = (List&lt;CartItem&gt;) redisTemplate.opsForValue().get(key);</span><br><span class="line">        <span class="comment">// 购物车不存在</span></span><br><span class="line">        <span class="keyword">if</span>(cart == <span class="keyword">null</span>)&#123;</span><br><span class="line">            cart = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">            cart.add(<span class="keyword">new</span> CartItem(productId, count, <span class="keyword">new</span> Date()));</span><br><span class="line">            redisTemplate.opsForValue().set(key, cart);</span><br><span class="line">            redisTemplate.expire(key, <span class="number">30</span>, TimeUnit.DAYS);</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"添加成功: "</span>+productId+<span class="string">"目前数量: "</span>+count;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 购物车存在</span></span><br><span class="line">        <span class="keyword">for</span> (CartItem cartItem : cart)&#123;</span><br><span class="line">            <span class="keyword">if</span>(cartItem.getProductId().longValue() == productId.longValue())&#123;</span><br><span class="line">                cartItem.setCount(cartItem.getCount()+count);</span><br><span class="line">                cartItem.setUpdateTime(<span class="keyword">new</span> Date());</span><br><span class="line">                redisTemplate.opsForValue().set(key, cart);</span><br><span class="line">                redisTemplate.expire(key, <span class="number">30</span>, TimeUnit.DAYS);</span><br><span class="line">                <span class="keyword">return</span> <span class="string">"添加成功: "</span>+productId+<span class="string">"目前数量: "</span>+count;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 购物车不存在该商品</span></span><br><span class="line">        cart.add(<span class="keyword">new</span> CartItem(productId, count, <span class="keyword">new</span> Date()));</span><br><span class="line">        redisTemplate.opsForValue().set(key, cart);</span><br><span class="line">        redisTemplate.expire(key, <span class="number">30</span>, TimeUnit.DAYS);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"添加成功: "</span>+productId+<span class="string">"目前数量: "</span>+count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">updateCount</span><span class="params">(String key, Long productId, Integer count)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        List&lt;CartItem&gt; carts = (List&lt;CartItem&gt;) redisTemplate.opsForValue().get(key);</span><br><span class="line">        <span class="keyword">if</span>(carts != <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">for</span> (CartItem item :carts)&#123;</span><br><span class="line">                <span class="keyword">if</span>(productId.longValue() == item.getProductId().longValue())&#123;</span><br><span class="line">                    item.setCount(item.getCount()+count);</span><br><span class="line">                    item.setUpdateTime(<span class="keyword">new</span> Date());</span><br><span class="line">                    redisTemplate.opsForValue().set(key, item);</span><br><span class="line">                    redisTemplate.expire(key, <span class="number">30</span>, TimeUnit.DAYS);</span><br><span class="line">                    <span class="keyword">return</span> <span class="string">"更新成功: "</span>+productId+<span class="string">"目前数量: "</span>+count;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"更新失败"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">del</span><span class="params">(String key, Long productId)</span> </span>&#123;</span><br><span class="line">        List&lt;CartItem&gt; carts = (List&lt;CartItem&gt;) redisTemplate.opsForValue().get(key);</span><br><span class="line">        <span class="keyword">if</span>(carts != <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">for</span>(CartItem item : carts)&#123;</span><br><span class="line">                <span class="keyword">if</span>(item.getProductId().longValue() == productId.longValue())&#123;</span><br><span class="line">                    carts.remove(item);</span><br><span class="line">                    redisTemplate.opsForValue().set(key, carts);</span><br><span class="line">                    redisTemplate.expire(key, <span class="number">30</span>, TimeUnit.DAYS);</span><br><span class="line">                    <span class="keyword">return</span> <span class="string">"删除成功"</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"删除失败"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;CartItemVo&gt; <span class="title">list</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        List&lt;CartItem&gt; cartItems = (List&lt;CartItem&gt;) redisTemplate.opsForValue().get(key);</span><br><span class="line">        <span class="keyword">if</span>(cartItems == <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> ArrayList&lt;CartItemVo&gt;();</span><br><span class="line">        &#125;</span><br><span class="line">        List&lt;CartItemVo&gt; cartItemVos = <span class="keyword">new</span> ArrayList&lt;&gt;(cartItems.size());</span><br><span class="line">        <span class="keyword">for</span>(CartItem cartItem : cartItems)&#123;</span><br><span class="line">            <span class="comment">// 将redis存储的List&lt;CartItem&gt;加入到List&lt;CartItemVo&gt;中</span></span><br><span class="line">            CartItemVo cartItemVo = <span class="keyword">new</span> CartItemVo();</span><br><span class="line">            cartItemVo.setCount(cartItem.getCount());</span><br><span class="line">            cartItemVo.setUpdateTime(cartItem.getUpdateTime());</span><br><span class="line">            StringBuilder stringBuilder = <span class="keyword">new</span> StringBuilder(<span class="string">"productId:"</span>).append(cartItem.getProductId());</span><br><span class="line">            TProduct product = (TProduct) redisTemplate.opsForValue().get(stringBuilder.toString());</span><br><span class="line">            <span class="keyword">if</span>(product == <span class="keyword">null</span>)&#123;</span><br><span class="line">                <span class="comment">// redis中没有，则查询数据库</span></span><br><span class="line">                product = productDao.queryById(cartItem.getProductId());</span><br><span class="line">                redisTemplate.opsForValue().set(stringBuilder.toString(), product);</span><br><span class="line">                <span class="comment">// 不是热门商品，不用设置太久</span></span><br><span class="line">                redisTemplate.expire(stringBuilder.toString(), <span class="number">60</span>, TimeUnit.MINUTES);</span><br><span class="line">            &#125;</span><br><span class="line">            cartItemVo.setProduct(product);</span><br><span class="line">            cartItemVos.add(cartItemVo);</span><br><span class="line">        &#125;</span><br><span class="line">        Collections.sort(cartItemVos, <span class="keyword">new</span> Comparator&lt;CartItemVo&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(CartItemVo o1, CartItemVo o2)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> (<span class="keyword">int</span>) (o2.getUpdateTime().getTime()-o1.getUpdateTime().getTime());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> cartItemVos;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>合并购物车</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">merge</span><span class="params">(String nologinKey, String loginKey)</span> </span>&#123;</span><br><span class="line">        List&lt;CartItem&gt; noLoginCart = (List&lt;CartItem&gt;) redisTemplate.opsForValue().get(nologinKey);</span><br><span class="line">        <span class="keyword">if</span>(noLoginCart == <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="comment">// 不存在未登陆购物车</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> ArrayList();</span><br><span class="line">        &#125;</span><br><span class="line">        List&lt;CartItem&gt; loginCart = (List&lt;CartItem&gt;) redisTemplate.opsForValue().get(loginKey);</span><br><span class="line">        <span class="keyword">if</span>(loginCart == <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="comment">// 不存在登陆购物车，则将未登录时购物车加入已登录时购物车</span></span><br><span class="line">            redisTemplate.opsForValue().set(loginKey, noLoginCart);</span><br><span class="line">            redisTemplate.expire(loginKey, <span class="number">30</span>, TimeUnit.DAYS);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 两者都存在</span></span><br><span class="line">        HashMap&lt;Long, CartItem&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span>(CartItem cartItem :noLoginCart)&#123;</span><br><span class="line">            map.put(cartItem.getProductId(), cartItem);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(CartItem cartItem :loginCart)&#123;</span><br><span class="line">            CartItem item = map.get(cartItem.getProductId());</span><br><span class="line">            <span class="keyword">if</span>(item == <span class="keyword">null</span>) &#123;</span><br><span class="line">                map.put(cartItem.getProductId(), cartItem);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                item.setCount(cartItem.getCount()+item.getCount());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// hashmap----&gt;list</span></span><br><span class="line">        Collection&lt;CartItem&gt; values = map.values();</span><br><span class="line">        List&lt;CartItem&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;(values);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// list写入已登录购物车，删除未登录购物车</span></span><br><span class="line">        redisTemplate.delete(noLoginCart);</span><br><span class="line">        <span class="comment">// 已登录购物车加入redis</span></span><br><span class="line">        redisTemplate.opsForValue().set(loginKey, loginCart);</span><br><span class="line">        redisTemplate.expire(loginKey, <span class="number">30</span>, TimeUnit.DAYS);</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-3-服务消费者配置"><a href="#5-3-服务消费者配置" class="headerlink" title="5.3 服务消费者配置"></a>5.3 服务消费者配置</h3><p><strong>未登录时购物车的Controller</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hofe.cart.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.config.annotation.Reference;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"cart"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CartController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Reference</span></span><br><span class="line">    <span class="keyword">private</span> ICartService cartService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"hello"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">hello</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"hello world"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"add/&#123;productId&#125;/&#123;count&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">add</span><span class="params">(@PathVariable(<span class="string">"productId"</span>)</span> Long productId,</span></span><br><span class="line"><span class="function">                          @<span class="title">PathVariable</span><span class="params">(<span class="string">"count"</span>)</span> Integer count,</span></span><br><span class="line"><span class="function">                          @<span class="title">CookieValue</span><span class="params">(name = <span class="string">"user_cart"</span>,required = <span class="keyword">false</span>)</span> String uuid,</span></span><br><span class="line"><span class="function">                          HttpServletResponse response)</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(uuid == <span class="keyword">null</span>)&#123;</span><br><span class="line">            uuid = UUID.randomUUID().toString();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        StringBuilder key = <span class="keyword">new</span> StringBuilder(<span class="string">"user:cart:"</span>).append(uuid);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//写cookie到客户端,更新有效期</span></span><br><span class="line">        Cookie cookie = <span class="keyword">new</span> Cookie(<span class="string">"user_cart"</span>, uuid);</span><br><span class="line">        cookie.setPath(<span class="string">"/"</span>);</span><br><span class="line">        cookie.setHttpOnly(<span class="keyword">true</span>);</span><br><span class="line">        cookie.setMaxAge(<span class="number">30</span>*<span class="number">24</span>*<span class="number">60</span>*<span class="number">60</span>);</span><br><span class="line">        response.addCookie(cookie);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> cartService.add(key.toString(),productId,count);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"update/&#123;productId&#125;/&#123;count&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">update</span><span class="params">(@PathVariable(<span class="string">"productId"</span>)</span> Long productId,</span></span><br><span class="line"><span class="function">                      @<span class="title">PathVariable</span><span class="params">(<span class="string">"count"</span>)</span> Integer count,</span></span><br><span class="line"><span class="function">                      @<span class="title">CookieValue</span><span class="params">(name = <span class="string">"user_cart"</span>,required = <span class="keyword">false</span>)</span> String uuid,</span></span><br><span class="line"><span class="function">                      HttpServletResponse response)</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(uuid == <span class="keyword">null</span> &amp;&amp; <span class="string">""</span>.equals(uuid))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"更新失败"</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        StringBuilder key = <span class="keyword">new</span> StringBuilder(<span class="string">"user:cart:"</span>).append(uuid);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//写cookie到客户端,更新有效期</span></span><br><span class="line">        Cookie cookie = <span class="keyword">new</span> Cookie(<span class="string">"user_cart"</span>, uuid);</span><br><span class="line">        cookie.setPath(<span class="string">"/"</span>);</span><br><span class="line">        cookie.setHttpOnly(<span class="keyword">true</span>);</span><br><span class="line">        cookie.setMaxAge(<span class="number">30</span>*<span class="number">24</span>*<span class="number">60</span>*<span class="number">60</span>);</span><br><span class="line">        response.addCookie(cookie);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> cartService.updateCount(key.toString(),productId,count);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"delete/&#123;productId&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">delete</span><span class="params">(@PathVariable(<span class="string">"productId"</span>)</span> Long productId,</span></span><br><span class="line"><span class="function">                             @<span class="title">CookieValue</span><span class="params">(name = <span class="string">"user_cart"</span>,required = <span class="keyword">false</span>)</span> String uuid,</span></span><br><span class="line"><span class="function">                             HttpServletResponse response)</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(uuid == <span class="keyword">null</span> &amp;&amp; <span class="string">""</span>.equals(uuid))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"删除失败"</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        StringBuilder key = <span class="keyword">new</span> StringBuilder(<span class="string">"user:cart:"</span>).append(uuid);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//写cookie到客户端,更新有效期</span></span><br><span class="line">        Cookie cookie = <span class="keyword">new</span> Cookie(<span class="string">"user_cart"</span>, uuid);</span><br><span class="line">        cookie.setPath(<span class="string">"/"</span>);</span><br><span class="line">        cookie.setHttpOnly(<span class="keyword">true</span>);</span><br><span class="line">        cookie.setMaxAge(<span class="number">30</span>*<span class="number">24</span>*<span class="number">60</span>*<span class="number">60</span>);</span><br><span class="line">        response.addCookie(cookie);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> cartService.del(key.toString(), productId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"list"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">list</span><span class="params">(@CookieValue(name = <span class="string">"user_cart"</span>,required = <span class="keyword">false</span>)</span> String uuid,</span></span><br><span class="line"><span class="function">                     HttpServletResponse response)</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(uuid == <span class="keyword">null</span>)&#123;</span><br><span class="line">            uuid = UUID.randomUUID().toString();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        StringBuilder key = <span class="keyword">new</span> StringBuilder(<span class="string">"user:cart:"</span>).append(uuid);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//写cookie到客户端,更新有效期</span></span><br><span class="line">        Cookie cookie = <span class="keyword">new</span> Cookie(<span class="string">"user_cart"</span>, uuid);</span><br><span class="line">        cookie.setPath(<span class="string">"/"</span>);</span><br><span class="line">        cookie.setHttpOnly(<span class="keyword">true</span>);</span><br><span class="line">        cookie.setMaxAge(<span class="number">30</span>*<span class="number">24</span>*<span class="number">60</span>*<span class="number">60</span>);</span><br><span class="line">        response.addCookie(cookie);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> cartService.list(key.toString());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>已登录时购物车的Controller</strong><br>在客户端发起请求到controller之间加入拦截器，用于获取用户登录状态，并将结果封装在HttpServletRequest request中</p>
<p>配置（加入拦截器）</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebConfig</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AuthInterceptor authInterceptor;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span></span>&#123;</span><br><span class="line">        registry.addInterceptor(authInterceptor).addPathPatterns(<span class="string">"/**"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>拦截器</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AuthInterceptor</span> <span class="keyword">implements</span> <span class="title">HandlerInterceptor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Reference</span></span><br><span class="line">    <span class="keyword">private</span> IUserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取用户登录状态</span></span><br><span class="line">        Cookie[] cookies = request.getCookies();</span><br><span class="line">        <span class="keyword">if</span>(cookies == <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (Cookie cookie :cookies)&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="string">"user_token"</span>.equals(cookie.getName()))&#123;</span><br><span class="line">                String uuid = cookie.getValue();</span><br><span class="line">                TUser user = userService.checkIsLogin(uuid);</span><br><span class="line">                <span class="keyword">if</span>(user != <span class="keyword">null</span>)&#123;</span><br><span class="line">                    request.setAttribute(<span class="string">"user"</span>, user);</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// controller级别用httpclient接口</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 无论是否登录，都放行到购物车</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>controller<br>如果已登录，则RedisKey为user:cart:userId；否则为user:cart:uuid</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@GetMapping</span>(<span class="string">"add/&#123;productId&#125;/&#123;count&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">add</span><span class="params">(@PathVariable(<span class="string">"productId"</span>)</span> Long productId,</span></span><br><span class="line"><span class="function">                          @<span class="title">PathVariable</span><span class="params">(<span class="string">"count"</span>)</span> Integer count,</span></span><br><span class="line"><span class="function">                          @<span class="title">CookieValue</span><span class="params">(name = <span class="string">"user_cart"</span>,required = <span class="keyword">false</span>)</span> String uuid,</span></span><br><span class="line"><span class="function">                          HttpServletResponse response,</span></span><br><span class="line"><span class="function">                          HttpServletRequest request)</span>&#123;</span><br><span class="line"></span><br><span class="line">        String key = <span class="string">""</span>;</span><br><span class="line">        <span class="comment">// 通过拦截器获取的登陆状态</span></span><br><span class="line">        TUser user = (TUser) request.getAttribute(<span class="string">"user"</span>);</span><br><span class="line">        <span class="keyword">if</span>(user != <span class="keyword">null</span>)&#123;</span><br><span class="line">            key = <span class="keyword">new</span> StringBuilder(<span class="string">"user:cart:"</span>).append(user.getId()).toString();</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(uuid == <span class="keyword">null</span>)&#123;</span><br><span class="line">                uuid = UUID.randomUUID().toString();</span><br><span class="line">            &#125;</span><br><span class="line">            key = <span class="keyword">new</span> StringBuilder(<span class="string">"user:cart:"</span>).append(uuid).toString();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//写cookie到客户端,更新有效期</span></span><br><span class="line">        Cookie cookie = <span class="keyword">new</span> Cookie(<span class="string">"user_cart"</span>, uuid);</span><br><span class="line">        cookie.setPath(<span class="string">"/"</span>);</span><br><span class="line">        cookie.setHttpOnly(<span class="keyword">true</span>);</span><br><span class="line">        cookie.setMaxAge(<span class="number">30</span>*<span class="number">24</span>*<span class="number">60</span>*<span class="number">60</span>);</span><br><span class="line">        response.addCookie(cookie);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> cartService.add(key.toString(),productId,count);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>合并购物车，修改已登录购物车的商品记录，同时清除未登录时购物车的记录</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"merge"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">merge</span><span class="params">(@CookieValue(name = <span class="string">"user_cart"</span>,required = <span class="keyword">false</span>)</span> String uuid,</span></span><br><span class="line"><span class="function">                      HttpServletResponse response, HttpServletRequest request) </span>&#123;</span><br><span class="line"></span><br><span class="line">        String key = <span class="string">""</span>;</span><br><span class="line">        <span class="comment">// 通过拦截器获取的登陆状态</span></span><br><span class="line">        TUser user = (TUser) request.getAttribute(<span class="string">"user"</span>);</span><br><span class="line">        <span class="keyword">if</span> (user == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> ArrayList();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (uuid == <span class="keyword">null</span> || <span class="string">""</span>.equals(uuid)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> ArrayList();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        String loginKey = <span class="keyword">new</span> StringBuilder(<span class="string">"user:cart:"</span>).append(user.getId()).toString();</span><br><span class="line">        String noLoginKey = <span class="keyword">new</span> StringBuilder(<span class="string">"user:cart:"</span>).append(uuid).toString();</span><br><span class="line"></span><br><span class="line">        List merge = cartService.merge(noLoginKey, loginKey);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//写cookie到客户端,清除未登录时购物车的id</span></span><br><span class="line">        Cookie cookie = <span class="keyword">new</span> Cookie(<span class="string">"user_cart"</span>, uuid);</span><br><span class="line">        cookie.setPath(<span class="string">"/"</span>);</span><br><span class="line">        cookie.setHttpOnly(<span class="keyword">true</span>);</span><br><span class="line">        cookie.setMaxAge(<span class="number">0</span>);</span><br><span class="line">        response.addCookie(cookie);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> merge;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h2 id="六、购物车优化"><a href="#六、购物车优化" class="headerlink" title="六、购物车优化"></a>六、购物车优化</h2><h3 id="6-1-回顾下之前购物车方案设计"><a href="#6-1-回顾下之前购物车方案设计" class="headerlink" title="6.1 回顾下之前购物车方案设计"></a>6.1 回顾下之前购物车方案设计</h3><p>首先在客户端向服务器发起请求后，通过拦截器获取当前是否登录，如果登陆的话就可以获得cookie: user_token对应的value（用户信息），无论登陆与否都放行。控制层接收请求，并将cookie: user_cart对应的value（购物车信息）注入到uuid中。<br><img src="/" class="lazyload" data-src="https://img-blog.csdnimg.cn/20200423165635836.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxMDExNzIz,size_16,color_FFFFFF,t_70"  alt="在这里插入图片描述"><br>获取拦截器封装在request中的用户信息，如果不为null，说明用户已登录，那这时候需要在用户的购物车中添加记录，故传递redis: user:cart:userid更改在redis中保存的用户购物车信息；如果用户未登录，则在客户端中的购物车中添加记录，先传递redis: user:cart:uuid用于变更redis中保存的客户端购物车信息，同时需要修改客户端保存的cookie，因为未登录时的购物车是通过客户端保存的cookie的uuid区别不同客户端的。<br><img src="/" class="lazyload" data-src="https://img-blog.csdnimg.cn/20200423165800811.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxMDExNzIz,size_16,color_FFFFFF,t_70"  alt="在这里插入图片描述"><br>当controller调用service时传入key(userid或uuid)及记录，service首先判断客户端或者用户是否已有购物车，如果没有则新建一个list作为购物车；如果存在购物车，就判断购物车中是否有该条记录，有的话则修改记录的商品数，没有的话则新增该商品记录，并存入到redis；存入到未登录的购物车还是已登录的购物车由传递来的key(userid或uuid)决定。<br><img src="/" class="lazyload" data-src="https://img-blog.csdnimg.cn/20200423171442499.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxMDExNzIz,size_16,color_FFFFFF,t_70"  alt="在这里插入图片描述"><br>用户未登陆时加入购物车的商品需要合并到登陆后的购物车中，首先获取uuid代表客户端的购物车和userid代表用户的购物车，调用合并函数将两辆购物车合并，同时需要清除客户端的购物车信息，通过将cookie存活时间设置为0即可。<br><img src="/" class="lazyload" data-src="https://img-blog.csdnimg.cn/20200423172004634.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxMDExNzIz,size_16,color_FFFFFF,t_70"  alt="在这里插入图片描述"><br>merge函数通过传递进来的uuid和userid获取redis中保存的数据，如果客户端购物车为空，则不用进行合并；如果如果用户购物车为空，则将未登录的购物车加入到已登录购物车的redis记录中，并删除未登录购物车的记录。<br><img src="/" class="lazyload" data-src="https://img-blog.csdnimg.cn/20200423173213106.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxMDExNzIz,size_16,color_FFFFFF,t_70"  alt="在这里插入图片描述"><br>如果两者都不为空，则先遍历未登录购物车获取productId即记录，将其加入map；再遍历登陆购物车，判断map中是否存在相同的productId，存在则修改其对应的数量，如果不存在则加入map。最后通过collection将map的value即商品记录转成list返回，同时删除未登录购物车对应的redis记录。<br><img src="/" class="lazyload" data-src="https://img-blog.csdnimg.cn/20200423173303847.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxMDExNzIz,size_16,color_FFFFFF,t_70"  alt="在这里插入图片描述"></p>
<h3 id="6-2-优化的购物车设计方案"><a href="#6-2-优化的购物车设计方案" class="headerlink" title="6.2 优化的购物车设计方案"></a>6.2 优化的购物车设计方案</h3><p>之前的设计方案存在着更新删除需要遍历List的缺点，故改用Hash存储，可直接通过Key获得Value，而不需要再遍历列表。</p>
<h2 id="七、订单模块（未完成）"><a href="#七、订单模块（未完成）" class="headerlink" title="七、订单模块（未完成）"></a>七、订单模块（未完成）</h2><h3 id="7-1-方案设计"><a href="#7-1-方案设计" class="headerlink" title="7.1 方案设计"></a>7.1 方案设计</h3><p>这一模块有几个过程：购物车结算-&gt;订单确认-&gt;生成订单-&gt;确认并支付。<br><strong>购物车结算-&gt;确认页面</strong><br>点击购物车结算后，跳转至确认页面，订单确认页面需要有用户地址信息、货物详情。故需要用户先登录，当用户访问确认也时，加入拦截器将页面从定向到登陆页面，记录referer，当用户登录成功后跳转回referer页面；货物详情通过uuid或者userid获得。</p>
<p><strong>订单确认-&gt;生成订单</strong><br>订单基本表和订单明细表：订单基本表需要有id/orderId/userId/transfer_no/name/phone/address（历史快照）/status/total_money/pay_type；订单明细表需要有id/order_id/product_id/count/name/price（历史快照）。</p>
<p>订单编号：唯一性、有序性（查询）、时间性。采用基于时间戳的方式+userID生成</p>
<p>库存的扣减：库存预扣减、超时未支付的检测。采用定时任务now-create_time。</p>
<p>选择购物车的部分商品下单：获取用户勾选id集合–等于批量删除，根据id集合选择购物车的部分商品信息，才将商品信息转换为订单。</p>
<p><strong>安全问题</strong><br>短信平台验证签名正确与否。发送签名：将用户id、token、时间戳通过MD5加密算法计算出sign发送给短信平台。短信平台验证签名：通过传递过来的sign获取用户id、token、时间戳，重新计算MD5判断是否与sign一致。缺陷：只保证了调用合法，明文传输无法保证内容合法。</p>
<p><strong>对接支付宝</strong><br>调用支付宝接口需要先生成RAS密钥，包含应用私钥与应用公钥。生存密钥后才可以获取支付宝公钥。</p>
<h2 id="八出现的问题"><a href="#八出现的问题" class="headerlink" title="八出现的问题"></a>八出现的问题</h2><h4 id="问题：在service中因为无法找到dao实现类导致的自动注入失败"><a href="#问题：在service中因为无法找到dao实现类导致的自动注入失败" class="headerlink" title="问题：在service中因为无法找到dao实现类导致的自动注入失败"></a>问题：在service中因为无法找到dao实现类导致的自动注入失败</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Field productTypeDao in com.hofe.productservice.service.ProductTypeService required a bean of type <span class="string">'com.hofe.dao.TProductTypeDao'</span> that could not be found.</span><br><span class="line"></span><br><span class="line">The injection point has the following annotations:</span><br><span class="line">	- <span class="meta">@org</span>.springframework.beans.factory.annotation.Autowired(required=<span class="keyword">true</span>)</span><br></pre></td></tr></table></figure>

<p>原因：考虑Spring未实例化对象<br>找不到bean的配置，以往是使用bean.xml文件进行配置，SpringBoot使用注解，就需要在入口程序中添加@MapperScan(“dao路径”)注解；同时也要考虑在注解方式下dao是否@mapper，xml方式下.xml文件存放路径是否正确；以及考虑application.yml中是否正确配置数据源。<br>可去掉Service上的@Component注解<br><img src="/" class="lazyload" data-src="https://img-blog.csdnimg.cn/20200416164704508.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxMDExNzIz,size_16,color_FFFFFF,t_70"  alt="在这里插入图片描述"><br><img src="/" class="lazyload" data-src="https://img-blog.csdnimg.cn/20200416164716547.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxMDExNzIz,size_16,color_FFFFFF,t_70"  alt="在这里插入图片描述"></p>
<h4 id="问题：找不到dao中的方法"><a href="#问题：找不到dao中的方法" class="headerlink" title="问题：找不到dao中的方法"></a>问题：找不到dao中的方法</h4><p> Invalid bound statement (not found): com.hofe.dao.TProductTypeDao.queryAll<br><img src="/" class="lazyload" data-src="https://img-blog.csdnimg.cn/202004162006550.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxMDExNzIz,size_16,color_FFFFFF,t_70"  alt="在这里插入图片描述"><br>解决办法：<br>在dao的pom中添加以下配置，标明xml配置存放路径</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&lt;build&gt;</span><br><span class="line">        &lt;resources&gt;</span><br><span class="line">            &lt;resource&gt;</span><br><span class="line">                &lt;directory&gt;resources&lt;/directory&gt;</span><br><span class="line">                &lt;includes&gt;</span><br><span class="line">                    &lt;include&gt;**<span class="comment">/*.xml&lt;/include&gt;</span></span><br><span class="line"><span class="comment">                &lt;/includes&gt;</span></span><br><span class="line"><span class="comment">            &lt;/resource&gt;</span></span><br><span class="line"><span class="comment">        &lt;/resources&gt;</span></span><br><span class="line"><span class="comment">    &lt;/build&gt;</span></span><br></pre></td></tr></table></figure>
<p>或者在service的application.yml指明mybatis配置</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">mybatis:</span><br><span class="line">  # 指定别名设置的包为所有entity</span><br><span class="line">  type-aliases-<span class="keyword">package</span>: cn.hofe.entity</span><br><span class="line">  configuration:</span><br><span class="line">    map-underscore-to-camel-case: true # 驼峰命名规范</span><br><span class="line">  mapper-locations: # mapper映射文件位置</span><br><span class="line">    - classpath:mapper<span class="comment">/*.xml</span></span><br></pre></td></tr></table></figure>


<h4 id="问题：字段名为name、desc时查询出错"><a href="#问题：字段名为name、desc时查询出错" class="headerlink" title="问题：字段名为name、desc时查询出错"></a>问题：字段名为name、desc时查询出错</h4><p>原因：数据表字段名不要用name，desc会与msql自带语法冲突<br>解决方法：1、在要用到关键字的地方加反引号标识；2、修改表字段名</p>
<p>问题：@Reference、@Service注解错误<br>原因：错用了java的注解导致Service无法正常注入</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">import com.alibaba.dubbo.config.annotation.Service;</span><br><span class="line">import com.alibaba.dubbo.config.annotation.Reference;</span><br></pre></td></tr></table></figure>

<h4 id="问题：平级转树形结构问题"><a href="#问题：平级转树形结构问题" class="headerlink" title="问题：平级转树形结构问题"></a>问题：平级转树形结构问题</h4><p>遇到需要返回树形结构的json数据，如多级菜单、多级类别等，可以使用VO与resultMap搭配，mybatis递归查询。需要注意的是，resultMap中的collection字段的column=“字段名”，不需要加{}；如需传递多个参数可加如{id, code}。这一字段代表的意思是第一次执行queryAllByCategory之后递归查询用到的parentId是这个category_type字段。<br><img src="/" class="lazyload" data-src="https://img-blog.csdnimg.cn/20200419192344559.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxMDExNzIz,size_16,color_FFFFFF,t_70"  alt="在这里插入图片描述"><br>树形结构的数据，可以不用外键进行关联；外键关联之后，无法将顶级的parentId设置值，只能默认null。</p>
<p>以下链接可参考：<br><a href="https://www.hangge.com/blog/cache/detail_2715.html" target="_blank" rel="noopener">https://www.hangge.com/blog/cache/detail_2715.html</a><br><a href="https://blog.csdn.net/janet796/article/details/79500349" target="_blank" rel="noopener">https://blog.csdn.net/janet796/article/details/79500349</a><br><a href="https://blog.csdn.net/qq_38164123/article/details/94358131" target="_blank" rel="noopener">https://blog.csdn.net/qq_38164123/article/details/94358131</a></p>
<p>问题：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">This application has no explicit mapping <span class="keyword">for</span> /error, so you are seeing this as a fallback.</span><br><span class="line">There was an unexpected error (<span class="built_in">type</span>=Internal Server Error, status=500).</span><br><span class="line">org.mybatis.spring.MyBatisSystemException: nested exception is org.apache.ibatis.reflection.ReflectionException: There is no getter <span class="keyword">for</span> property named <span class="string">'parentId'</span> <span class="keyword">in</span> <span class="string">'class java.lang.Integer'</span> org.mybatis.spring.MyBatisSystemException: nested exception is org.apache.ibatis.reflection.ReflectionException</span><br></pre></td></tr></table></figure>
<p>在使用choose之类条件控制语句的时候，要注意它判断的是传进来的参数的拥有的字段，如果传进来是个user可以使用；如果只传进来username，则无法控制password条件<br><img src="/" class="lazyload" data-src="https://img-blog.csdnimg.cn/20200419233256361.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxMDExNzIz,size_16,color_FFFFFF,t_70"  alt="在这里插入图片描述"></p>
<h4 id="问题：dubbo超时"><a href="#问题：dubbo超时" class="headerlink" title="问题：dubbo超时"></a>问题：dubbo超时</h4><p>Invoke remote method timeout. method: queryCategorys, provider: dubbo:<br>默认超时时间是1000ms，120条数据加上递归就超时了，可以在消费者和提供者端设置timeout=30000</p>
<h4 id="问题：SSO单点登录模块跨域问题"><a href="#问题：SSO单点登录模块跨域问题" class="headerlink" title="问题：SSO单点登录模块跨域问题"></a>问题：SSO单点登录模块跨域问题</h4><p>认证模块通过了，可其他模块在发送ajax请求时还是无法携带cookie。<br>在SSO登录之后，浏览器返回cookie，其携带着uuid信息，其他系统在发送ajax请求时，携带这个cookie信息就可免登录。但需要在Controller的类或者方法上加上注解@CrossOrigin(origins = “*”, allowCredentials = “true”)，允许所有端口的访问，并允许携带cookie<br>前端ajax代码需要withCredentials:true</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&amp;ajax(&#123;</span><br><span class="line">	url:<span class="string">"http://localhost:9098/sso/checkIsLogin"</span>,</span><br><span class="line">	xhrFields:&#123;<span class="attr">withCredentials</span>:<span class="literal">true</span>&#125;,</span><br><span class="line">	crossDomain:<span class="literal">true</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>需要注意的是，cart.hofe.com并不能保存shop.hofe.com的cookie，故设置的时候要设置父域名cookie.setDomain(“hofe.com”)</p>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">hofe</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://hofe.work/2020/04/15/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A4/Dubbo%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91%E8%AE%B0%E5%BD%95/">http://hofe.work/2020/04/15/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A4/Dubbo%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91%E8%AE%B0%E5%BD%95/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://hofe.work" target="_blank">Hofe's blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Dubbo/">Dubbo</a></div><div class="post_share"><div class="social-share" data-image="/img/post.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button button--primary button--animated"> <i class="fa fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img/wechat.jpg" alt="微信"/><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img/alipay.jpg" alt="支付宝"/><div class="post-qr-code__desc">支付宝</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2020/04/27/Java/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"><img class="prev_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/hhf443/blog-graph/img/20200502153305.png" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Java多线程学习笔记</div></div></a></div><div class="next-post pull_right"><a href="/2020/04/09/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A4/SpringCloud%E5%85%A5%E9%97%A8%E5%AE%9E%E6%88%98(%E4%BA%8C)%E9%9B%86%E6%88%90Ribbon/"><img class="next_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/hhf443/blog-graph/img/20200427150327.png" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Spring Cloud入门实战(三)--集成Ribbon</div></div></a></div></nav><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> 评论</span></div><div class="vcomment" id="vcomment"></div><script src="https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js"></script><script>var GUEST_INFO = ['nick','mail','link'];
var guest_info = 'nick,mail,link'.split(',').filter(function(item){
  return GUEST_INFO.indexOf(item) > -1
});
guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;

window.valine = new Valine({
  el:'#vcomment',
  notify: false,
  verify: false,
  appId: 'b5cpWE77l9G2Um3MSdyvAmh6-gzGzoHsz',
  appKey: 'LCxOgpdF1CrQ1Xb4dnNrg6OH',
  placeholder: '留下你的足迹吧',
  avatar: 'monsterid',
  meta: guest_info,
  pageSize: '10',
  lang: 'en',
  recordIP: true,
  serverURLs: ''
});</script></div></article></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2020 By hofe</div><div class="framework-info"><span>驱动 </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div><div class="footer_custom_text">Hi, welcome to my <a href="http://hofe.work/">blog</a>!</div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="直达评论"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script id="ribbon_piao" mobile="false" src="/js/third-party/piao.js"></script><script src="/js/third-party/activate-power-mode.js"></script><script>POWERMODE.colorful = false;
POWERMODE.shake = true;
document.body.addEventListener('input', POWERMODE);
</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async=""></script><script src="/js/search/local-search.js"></script></body></html>